<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç§’é€Ÿãƒ»è³‡é‡‘é…åˆ†ãƒ„ãƒ¼ãƒ« [ç©¶æ¥µç‰ˆ]</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: #f4f7f6; color: #333; max-width: 600px; margin: 0 auto; padding: 20px; }
        h1 { font-size: 1.3rem; text-align: center; color: #d32f2f; margin-bottom: 5px;}
        p.subtitle { text-align: center; font-size: 0.85rem; color: #666; margin-bottom: 20px; }
        .card { background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-bottom: 20px;}
        label { font-weight: bold; font-size: 0.95rem; color: #444; display: block; margin-bottom: 5px;}
        input[type="number"] { width: 100%; padding: 12px; margin-bottom: 15px; border: 2px solid #ddd; border-radius: 6px; font-size: 18px; box-sizing: border-box; background: #fafafa; font-weight: bold;}
        textarea { width: 100%; height: 160px; padding: 12px; margin-bottom: 15px; border: 2px solid #ddd; border-radius: 6px; font-size: 15px; box-sizing: border-box; background: #fafafa; resize: vertical; line-height: 1.5; color: #333;}
        textarea::placeholder { color: #999; }
        textarea:focus, input[type="number"]:focus { border-color: #d32f2f; outline: none; }
        button { background: #d32f2f; color: white; border: none; padding: 16px; width: 100%; border-radius: 6px; font-size: 18px; font-weight: bold; cursor: pointer; transition: 0.2s; box-shadow: 0 4px 0 #b71c1c;}
        button:active { transform: translateY(4px); box-shadow: none; }
        .notice { font-size: 0.8rem; color: #d32f2f; margin-bottom: 15px; font-weight: bold;}
        table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 0.95rem;}
        th, td { padding: 10px 5px; text-align: right; border-bottom: 1px solid #ddd; }
        th { background: #f8f8f8; color: #555; font-weight: normal; font-size: 0.85rem;}
        td.bet-name { text-align: left; font-weight: bold; color: #555; font-size: 0.9rem;}
        td.buy-amount { color: #d32f2f; font-weight: bold; font-size: 1.1rem;}
        .summary { display: flex; justify-content: space-between; background: #fff3f3; padding: 15px; border-radius: 6px; border: 1px solid #ffcdd2; margin-bottom: 15px;}
        .summary div { text-align: center; }
        .summary span { display: block; font-size: 1.3rem; font-weight: bold; color: #d32f2f; margin-top: 5px;}
    </style>
</head>
<body>
    <h1>ğŸ”¥ ç§’é€Ÿãƒ»è³‡é‡‘é…åˆ†ãƒ„ãƒ¼ãƒ«</h1>
    <p class="subtitle">ã‚ªãƒƒã‚ºã‚’ã‚³ãƒ”ãƒšã™ã‚‹ã ã‘ã§ä¸€ç¬ã§æœ€é©åŒ–</p>
    
    <div class="card">
        <label>ç·äºˆç®— (å††):</label>
        <input type="number" id="budget" value="10000" step="100">
        
        <label>ã‚ªãƒƒã‚ºè¡¨ã‚’ãã®ã¾ã¾ãƒšãƒ¼ã‚¹ãƒˆ:</label>
        <p style="font-size:0.8rem; color:#666; margin-top:0;">â€»è²·ã„ç›®ã¨ã‚ªãƒƒã‚ºã‚’è‡ªå‹•ã§åˆ¤åˆ¥ã—ã¾ã™ã€‚</p>
        <textarea id="bulk-odds" placeholder="ã€å…¥åŠ›ä¾‹ã€‘&#10;1-2-3 150.5å€&#10;2-4-1 49&#10;å˜å‹ 7 4.5å€"></textarea>
        
        <p class="notice" id="save-notice">âœ”ï¸ å…¥åŠ›å†…å®¹ã¯è‡ªå‹•ä¿å­˜ã•ã‚Œã¦ã„ã¾ã™</p>
        <button onclick="calculate()">ä¸€ç™ºè¨ˆç®— (æŠ½å‡ºï¼†é…åˆ†)</button>
    </div>

    <div class="card" id="result-card" style="display:none;">
        <div class="summary">
            <div>å®Ÿéš›ã®è³¼å…¥é¡<br><span id="actual-total">0</span></div>
            <div>å¹³å‡æ‰•æˆ»è¦‹è¾¼<br><span id="avg-return">0</span></div>
        </div>
        <table id="result-table">
            </table>
    </div>

    <script>
        const budgetInput = document.getElementById('budget');
        const bulkOddsInput = document.getElementById('bulk-odds');

        window.onload = () => {
            if(localStorage.getItem('savedBudget')) budgetInput.value = localStorage.getItem('savedBudget');
            if(localStorage.getItem('savedOdds')) bulkOddsInput.value = localStorage.getItem('savedOdds');
        };

        budgetInput.addEventListener('input', () => localStorage.setItem('savedBudget', budgetInput.value));
        bulkOddsInput.addEventListener('input', () => localStorage.setItem('savedOdds', bulkOddsInput.value));

        function calculate() {
            const budget = parseFloat(budgetInput.value);
            const rawText = bulkOddsInput.value;

            if (!rawText || !budget) {
                alert("äºˆç®—ã¨ã‚ªãƒƒã‚ºã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
                return;
            }

            let betsList = [];
            const lines = rawText.split('\n');
            
            lines.forEach(line => {
                if (!line.trim()) return; // ç©ºè¡Œã¯ç„¡è¦–

                // ã‚ªãƒƒã‚ºã‚’ç‰¹å®šã™ã‚‹ãŸã‚ã®å‡¦ç†
                let cleanLine = line.replace(/\d+(-\d+)+/g, ' '); // é¦¬ç•ª(1-2ç­‰)ã‚’ä¸€æ—¦æ¶ˆã™
                cleanLine = cleanLine.replace(/[\(\[\<]\d+[\)\]\>]/g, ' ');
                const matches = cleanLine.match(/\d+(?:\.\d+)?/g);
                
                if (matches) {
                    const oddsStr = matches[matches.length - 1]; // ä¸€ç•ªå¾Œã‚ã®æ•°å­—ã‚’ã‚ªãƒƒã‚ºã¨ã™ã‚‹
                    const extractedOdds = parseFloat(oddsStr);
                    
                    if(extractedOdds > 0) {
                        // å…ƒã®è¡Œã‹ã‚‰ã‚ªãƒƒã‚ºã®æ–‡å­—åˆ—ã¨ã€Œå€ã€ãªã©ã‚’å–ã‚Šé™¤ãã€è²·ã„ç›®åã«ã™ã‚‹
                        let lastIndex = line.lastIndexOf(oddsStr);
                        let betName = line;
                        if (lastIndex !== -1) {
                            betName = line.substring(0, lastIndex) + line.substring(lastIndex + oddsStr.length);
                        }
                        betName = betName.replace(/å€/g, '').replace(/å††/g, '').trim();
                        if (!betName) betName = "æŒ‡å®šãªã—"; // æ•°å­—ã—ã‹å…¥åŠ›ã•ã‚Œãªã‹ã£ãŸå ´åˆ

                        betsList.push({ name: betName, odds: extractedOdds });
                    }
                }
            });

            if (betsList.length === 0) {
                alert("ã‚ªãƒƒã‚ºãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚");
                return;
            }

            // ã‚ªãƒƒã‚ºãŒé«˜ã„é †ï¼ˆã¾ãŸã¯è²·ã„ç›®é †ï¼‰ã«ä¸¦ã¹æ›¿ãˆå¯èƒ½ã§ã™ãŒã€ä»Šå›ã¯ã‚ªãƒƒã‚ºã®é™é †ã«ã—ã¾ã™
            betsList.sort((a, b) => b.odds - a.odds);
            
            let sumInverse = 0;
            betsList.forEach(bet => { sumInverse += (1 / bet.odds); });

            const targetReturn = budget / sumInverse;
            let tableHTML = '<tr><th style="text-align:left;">è²·ã„ç›®</th><th>ã‚ªãƒƒã‚º</th><th>è³¼å…¥é¡(å††)</th><th>æ‰•æˆ»è¦‹è¾¼</th></tr>';
            let actualTotal = 0;
            let totalReturn = 0;

            betsList.forEach(bet => {
                let rawStake = targetReturn / bet.odds;
                let stake = Math.round(rawStake / 100) * 100;
                if(stake === 0) stake = 100; 
                
                actualTotal += stake;
                let expectedReturn = Math.floor(stake * bet.odds);
                totalReturn += expectedReturn;
                
                tableHTML += `<tr>
                    <td class="bet-name">${bet.name}</td>
                    <td>${bet.odds}</td>
                    <td class="buy-amount">${stake.toLocaleString()}</td>
                    <td>${expectedReturn.toLocaleString()}</td>
                </tr>`;
            });

            document.getElementById('actual-total').innerText = actualTotal.toLocaleString() + "å††";
            document.getElementById('avg-return').innerText = Math.floor(totalReturn / betsList.length).toLocaleString() + "å††";
            document.getElementById('result-table').innerHTML = tableHTML;
            document.getElementById('result-card').style.display = 'block';
            document.getElementById('result-card').scrollIntoView({ behavior: 'smooth' });
        }
    </script>
</body>
</html>